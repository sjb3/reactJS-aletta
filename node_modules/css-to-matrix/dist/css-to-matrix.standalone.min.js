function a(a){this.model=new umodel({matrix:new matrixUtilities.Identity,transformations:{perspective:new matrixUtilities.Identity,rotate:new matrixUtilities.Identity,scale:new matrixUtilities.Identity,skew:new matrixUtilities.Identity,translate:new matrixUtilities.Identity}}),a&&this.matrix(a)}!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("matrix-utilities",[],b):a["matrix-utilities"]=b()}(this,function(){var a;return a=function(){var a;return a={add:function(a,b){var c,d,e,f,g,h,i,j,k;if(a.length!==b.length)throw new Error("Matrix y dimensions do not match");for(e=[],c=h=0,j=a.length;j>h;c=++h){if(f=a[c],f.length!==b[c].length)throw new Error("Matrix x dimensions do not match on row "+(c+1));for(e[c]=[],d=i=0,k=f.length;k>i;d=++i)g=f[d],e[c][d]=g+b[c][d]}return e},multiply:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;if(a[0].length!==b.length)throw new Error("Matrix 1's row count should equal matrix 2's column count");for(h=a[0].length,f=[],c=k=0,m=b.length;m>k;c=++k)for(g=b[c],f[c]=[],d=l=0,n=g.length;n>l;d=++l){for(j=g[d],e=h,i=0;e--;)i+=a[c][e]*b[e][d];f[c][d]=i}return f},flip:function(a){var b,c,d,e,f,g,h,i,j;for(d=[],b=g=0,i=a.length;i>g;b=++g)for(e=a[b],c=h=0,j=e.length;j>h;c=++h)f=e[c],(d[c]||(d[c]=[]))[b]=f;return d},to2d:function(a){return[[a[0][0]||1,a[0][1]||0,a[0][3]||0],[a[1][0]||0,a[1][1]||1,a[1][3]||0]]},to3d:function(a){return[[a[0][0]||1,a[0][1]||0,0,a[0][2]||0],[a[1][0]||0,a[1][1]||1,0,a[1][2]||0],[0,0,1,0],[0,0,0,1]]},Identity:function(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}}}()}),function(){var a,b;b=function(a){return"object"==typeof exports?module.exports=a:"function"==typeof define&&define.amd?define([],a):this["transform-to-matrix"]=a},a={perspective:function(a){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,-1/a,1]]},rotate:function(b){return a.rotateZ(b)},rotateX:function(b){return a.rotate3d(1,0,0,b)},rotateY:function(b){return a.rotate3d(0,1,0,b)},rotateZ:function(a){var b,c;return b=Math.cos(a),c=Math.sin(a),[[b,-c,0],[c,b,0]]},rotate3d:function(a,b,c,d){var e,f,g,h,i;return i=a*a+b*b+c*c,e=Math.cos(d),g=Math.sin(d),f=1-e,h=Math.sqrt(i)*g,[[(a*a+(b*b+c*c)*e)/i,(a*b*f-c*h)/i,(a*c*f+b*h)/i,0],[(a*b*f+c*h)/i,(b*b+(a*a+c*c)*e)/i,(b*c*f-a*h)/i,0],[(a*c*f-b*h)/i,(b*c*f+a*h)/i,(c*c+(a*a+b*b)*e)/i,0],[0,0,0,1]]},scale:function(a,b){return[[a,0,0],[0,b,0]]},scaleX:function(b){return a.scale(b,1)},scaleY:function(b){return a.scale(1,b)},scaleZ:function(b){return a.scale3d(1,1,b)},scale3d:function(a,b,c){return[[a,0,0,0],[0,b,0,0],[0,0,c,0],[0,0,0,1]]},skew:function(a,b){return[[1,Math.tan(a),0],[Math.tan(b),1,0]]},skewX:function(a){return[[1,Math.tan(a),0],[0,1,0]]},skewY:function(a){return[[1,0,0],[Math.tan(a),1,0]]},translate:function(a,b){return[[1,0,a],[0,1,b]]},translateX:function(b){return a.translate(b,0)},translateY:function(b){return a.translate(0,b)},translateZ:function(b){return a.translate3d(0,0,b)},translate3d:function(a,b,c){return[[1,0,0,a],[0,1,0,b],[0,0,1,c],[0,0,0,1]]}},b(a)}.call(this),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("umodel",[],b):a.umodel=b()}(this,function(){var a,b,c={}.hasOwnProperty;return b={extend:function(a,b){var d;for(d in b)c.call(b,d)&&(a[d]=b[d]);return a},trim:function(){var a,b;return"".trim?function(a){return a.trim()}:(a=/^\s\s*/,b=/\s\s*$/,function(c){return c.replace(a,"").replace(b,"")})}()},a=function(){function a(a,c){this._data=null!=a?a:{},this.options={separator:"/"},c&&b.extend(this.options,c),this.events={}}return a.prototype.get=function(a){return this.trigger("get",a),this._get(this._split(a),this._data)},a.prototype.set=function(a,b){var c;return c=this._get(this._split(a),this._data),this._set(this._split(a),b,!1,this._data),this.trigger("set",a,b,c)},a.prototype.setnx=function(a,b){var c;return c=this._get(this._split(a),this._data),this._set(this._split(a),b,!0,this._data),this.trigger("setnx",a,b,c)},a.prototype.on=function(a,b){var c,d;if(b)return this._on(a,b);d=[];for(c in a)b=a[c],d.push(this._on(c,b));return d},a.prototype.trigger=function(a,b,c,d){var e,f,g,h,i;if(null==b&&(b="*"),b=this._normalize(b),a in this.events){h=this.events[a],i=[];for(e in h)g=h[e],i.push("*"===e||0===(b+"/").indexOf(e+"/")?function(){var a,e,h;for(h=[],a=0,e=g.length;e>a;a++)f=g[a],h.push(null!=d?f.call(this,b,c,d):f.call(this,b,c));return h}.call(this):void 0);return i}},a.prototype._get=function(a,b,c){var d;return null==c&&(c=[]),d=a.shift(),d?d in b?(c.push(d),this._get(a,b[d],c)):void 0:b},a.prototype._set=function(a,b,c,d,e){var f;return null==c&&(c=!1),null==e&&(e=[]),f=a.shift(),a.length?(f in d||(d[f]={}),e.push(f),this._set(a,b,c,d[f],e)):c&&f in d?void 0:d[f]=b},a.prototype._on=function(a,c){var d,e,f,g,h,i,j;for(f=a.split(":"),e=f[0].split(" "),g=this._normalize(f[1]||"*"),j=[],h=0,i=e.length;i>h;h++)d=e[h],d=b.trim(d),d in this.events||(this.events[d]={}),g in this.events[d]||(this.events[d][g]=[]),j.push(this.events[d][g].push(c));return j},a.prototype._normalize=function(a){var c;return c=this.options.separator,a=b.trim(a),a.charAt(0)===c&&(a=a.slice(1)),a.charAt(a.length-1)===c&&(a=a.slice(0,-1)),a},a.prototype._split=function(a){return this._normalize(a).split(this.options.separator)},a}()});var b={rad:function(a){if("string"==typeof a){var b=parseFloat(a,10),c=a.indexOf("deg")>-1;return c&&(b*=Math.PI/180),b}return a},extend:function(a,b){for(var c in b)a[c]=b[c];return a},fluent:function(a){return function(){return a.apply(this,arguments),this}},isNumber:function(a){return"number"==typeof a}};b.extend(a.prototype,{matrix:function(a){if(null==a.length)throw new TypeError("expected parameter `data` to be an Array, but was given a "+typeof a);var b=a.length,c=b>0?b:0;if(4!==b||4!==c)throw new Error("expected parameter `data` to be a 4x4 matrix of arrays, but was given a "+b+"x"+c+" matrix");this.model.set("matrix",a)},getMatrix:function(){var a=this.model.get("matrix"),b=this.model.get("transformations");return a=matrixUtilities.multiply(a,b.perspective),a=matrixUtilities.multiply(a,b.translate),a=matrixUtilities.multiply(a,b.rotate),a=matrixUtilities.multiply(a,b.skew),a=matrixUtilities.multiply(a,b.scale),matrixUtilities.flip(a)},getMatrixCSS:function(){return"matrix3d("+this.getMatrix().reduce(function(a,b){return a.push.apply(a,b),a},[]).join(",")+")"},rotate:function(a){return this.rotateZ(a)},rotateX:function(a){return this.rotate3d(1,0,0,a)},rotateY:function(a){return this.rotate3d(0,1,0,a)},rotateZ:function(a){return this.rotate3d(0,0,1,a)},scale:function(a,b){return this.scale3d(a,b)},scaleX:function(a){return this.scale3d(a)},scaleY:function(a){return this.scale3d(null,a)},scaleZ:function(a){return this.scale3d(null,null,a)},skewX:function(a){return this.skew(a)},skewY:function(a){return this.skew(null,a)},translate:function(a,b){return this.translate3d(a,b)},translateX:function(a){return this.translate3d(a)},translateY:function(a){return this.translate3d(null,a)},translateZ:function(a){return this.translate3d(null,null,a)},perspective:b.fluent(function(a){if(null==a&&(a=0),!b.isNumber(a))throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof a);this.model.set("transformations/perspective",transformToMatrix.perspective(a))}),rotate3d:b.fluent(function(a,c,d,e){if(null==a&&(a=0),null==c&&(c=0),null==d&&(d=0),null==e&&(e=0),!b.isNumber(a))throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof a);if(!b.isNumber(c))throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof c);if(!b.isNumber(d))throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof d);this.model.set("transformations/rotate",transformToMatrix.rotate3d(a,c,d,b.rad(e)))}),scale3d:b.fluent(function(a,c,d){if(null==a&&(a=1),null==c&&(c=1),null==d&&(d=1),!b.isNumber(a))throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof a);if(!b.isNumber(c))throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof c);if(!b.isNumber(d))throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof d);this.model.set("transformations/scale",transformToMatrix.scale3d(a,c,d))}),skew:b.fluent(function(a,c){null==a&&(a=0),null==c&&(c=0),this.model.set("transformations/skew",matrixUtilities.to3d(transformToMatrix.skew(b.rad(a),b.rad(c))))}),translate3d:b.fluent(function(a,c,d){if(null==a&&(a=0),null==c&&(c=0),null==d&&(d=0),!b.isNumber(a))throw new TypeError("expected parameter `x` to be a Number, but was given a "+typeof a);if(!b.isNumber(c))throw new TypeError("expected parameter `y` to be a Number, but was given a "+typeof c);if(!b.isNumber(d))throw new TypeError("expected parameter `z` to be a Number, but was given a "+typeof d);this.model.set("transformations/translate",transformToMatrix.translate3d(a,c,d))})});